<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>C Container Collection (CCC): CCC_Array_tree_map Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">C Container Collection (CCC)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('structCCC__Array__tree__map.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle"><div class="title">CCC_Array_tree_map Struct Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="private__array__tree__map_8h_source.html">private_array_tree_map.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for CCC_Array_tree_map:</div>
<div class="dyncontent">
<div class="center"><img src="structCCC__Array__tree__map__coll__graph.png" border="0" usemap="#aCCC__Array__tree__map_coll__map" alt="Collaboration graph"/></div>
<map name="aCCC__Array__tree__map_coll__map" id="aCCC__Array__tree__map_coll__map">
<area shape="rect" title=" " alt="" coords="25,93,185,119"/>
<area shape="rect" href="structCCC__Array__tree__map__node.html" title=" " alt="" coords="5,5,204,31"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>An array tree map is a modified struct of arrays layout with the modification being that we may have the arrays as pointer offsets in a contiguous allocation if the user desires a dynamic map.</p>
<p>The user data array comes first allowing the user to store any type they wish in the container contiguously with no intrusive element padding, saving space.</p>
<p>The nodes array is next. These nodes track the indices of the child and parent nodes in the WAVL tree.</p>
<p>Finally, comes the parity bit array. This comes last because it allows the optimal storage space to be used, a single bit. Usually, a data structure theorist's "bit" of extra information per node comes out to a byte in practice due to portability and implementation concerns. If this byte were to be included in the current map elem, it would then be given 7 more bytes of padding by the compiler to ensure proper alignment, wasting large amounts of space. Instead all the bits are packed into their own bit array at the end of the allocation. The bit at a given index represents the parity of data and its node at that same index. This allows the implementation to follow the theorist's ideal.</p>
<p>Here is the layout in one contiguous array.</p>
<p>(D = Data Array, N = Nodes Array, P = Parity Bit Array, _N = Capacity - 1)</p>
<p>┌───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┬───┐ │D_0│D_1│...│D_N│N_0│N_1│...│N_N│P_0│P_1│...│P_N│ └───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┴───┘</p>
<p>Consider how this layout saves space. Here is a more traditional approach.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Naive_node</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> branch[2];</div>
<div class="line">    <span class="keyword">union</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">size_t</span> parent;</div>
<div class="line">        <span class="keywordtype">size_t</span> next_free;</div>
<div class="line">    };</div>
<div class="line">    uint8_t parity;</div>
<div class="line">};</div>
</div><!-- fragment --><p>This struct wastes a byte for parity when only a bit is needed. It also has an alignment of 8 bytes meaning the trailing 7 bytes are completely useless. If this element were to intrude on a user element it would also force its 8 byte alignment on user data. This is more wasted space if the user wanted to simply use the map as a set for a smaller type such as an int.</p>
<p>If the user wanted a simple set of 64 ints we have the following waste.</p>
<div class="fragment"><div class="line">64 structs * 40 bytes = 2480 total bytes</div>
<div class="line">64 structs * (40 bytes - 7 bytes padding - 4 bytes padding) = 1856 usable bytes</div>
<div class="line">2480 - 1856 = 624 bytes wasted.</div>
</div><!-- fragment --><p>In contrast the current struct of arrays design lays out data as follows.</p>
<div class="fragment"><div class="line">  (64 ints * 4 bytes per int)</div>
<div class="line">+ (4 bytes padding)</div>
<div class="line">+ (64 <a class="code hl_variable" href="structCCC__Array__tree__map.html#a63ea33a04096cccedeee7f8ff3e7fcb9">nodes</a> * 24 bytes per node)</div>
<div class="line">+ (64 bits)</div>
<div class="line">+ (B padding bits in last word)</div>
<div class="line">--------------------------------</div>
<div class="line">= 1860 + B padding bits in last word (in <span class="keyword">this</span> <span class="keywordflow">case</span> 0)</div>
<div class="ttc" id="astructCCC__Array__tree__map_html_a63ea33a04096cccedeee7f8ff3e7fcb9"><div class="ttname"><a href="structCCC__Array__tree__map.html#a63ea33a04096cccedeee7f8ff3e7fcb9">CCC_Array_tree_map::nodes</a></div><div class="ttdeci">struct CCC_Array_tree_map_node * nodes</div><div class="ttdef"><b>Definition:</b> private_array_tree_map.h:136</div></div>
</div><!-- fragment --><p>That means there are only <code>4 bytes + B bits</code> wasted, 4 bytes of padding between the end of the user type array and the start of the nodes array and the unused bits at the end of the parity bit array. This also means it important to consider the alignment differences that may occur between the user type and the node type.</p>
<p>This layout comes at the cost of consulting multiple arrays for many operations. However, once user data has been inserted or removed the tree fix up operations only need to consult the nodes array and the bit array which means more bits and nodes can be loaded on a cache line. We no longer need to consider arbitrarily sized or organized user data while we do operations on nodes and bits. Performance metrics still must be measured to say whether this is faster or slower than other approaches. However, the goal with this design is space efficiency first, speed second. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a025a6cc3eb3316bdb34e180b29d02957"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a025a6cc3eb3316bdb34e180b29d02957">data</a></td></tr>
<tr class="separator:a025a6cc3eb3316bdb34e180b29d02957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63ea33a04096cccedeee7f8ff3e7fcb9"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structCCC__Array__tree__map__node.html">CCC_Array_tree_map_node</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a63ea33a04096cccedeee7f8ff3e7fcb9">nodes</a></td></tr>
<tr class="separator:a63ea33a04096cccedeee7f8ff3e7fcb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a0ea7b9abddc4932b4366f456fcd086"><td class="memItemLeft" align="right" valign="top">unsigned *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a0a0ea7b9abddc4932b4366f456fcd086">parity</a></td></tr>
<tr class="separator:a0a0ea7b9abddc4932b4366f456fcd086"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bed019d4d38e55783a0696eafd779b8"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a3bed019d4d38e55783a0696eafd779b8">root</a></td></tr>
<tr class="separator:a3bed019d4d38e55783a0696eafd779b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a480c4dc805eef262657a79a4f40b72dd"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a480c4dc805eef262657a79a4f40b72dd">free_list</a></td></tr>
<tr class="separator:a480c4dc805eef262657a79a4f40b72dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a7afb21dde4cff08c927cbe19b76f18"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a2a7afb21dde4cff08c927cbe19b76f18">capacity</a></td></tr>
<tr class="separator:a2a7afb21dde4cff08c927cbe19b76f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a260771ed0124d74c1eba644669e07eea"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a260771ed0124d74c1eba644669e07eea">count</a></td></tr>
<tr class="separator:a260771ed0124d74c1eba644669e07eea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23ab5d7c4b9a351dff64f8e8c5eca5bd"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a23ab5d7c4b9a351dff64f8e8c5eca5bd">sizeof_type</a></td></tr>
<tr class="separator:a23ab5d7c4b9a351dff64f8e8c5eca5bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae68de9bf0bf0fed7ff1b92592f58e346"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#ae68de9bf0bf0fed7ff1b92592f58e346">key_offset</a></td></tr>
<tr class="separator:ae68de9bf0bf0fed7ff1b92592f58e346"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af96de570b4860842765b9b0a2ce690dc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#a70073fb5defeba83308b92f2fff63fac">CCC_Key_comparator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#af96de570b4860842765b9b0a2ce690dc">compare</a></td></tr>
<tr class="separator:af96de570b4860842765b9b0a2ce690dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ac8dcc6750a564b336942ef5d458955"><td class="memItemLeft" align="right" valign="top"><a class="el" href="types_8h.html#aac6280c471e14b9c0d50b1c5577394d3">CCC_Allocator</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a9ac8dcc6750a564b336942ef5d458955">allocate</a></td></tr>
<tr class="separator:a9ac8dcc6750a564b336942ef5d458955"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5f12772a9d9be3dad93820d885a6bcc8"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCCC__Array__tree__map.html#a5f12772a9d9be3dad93820d885a6bcc8">context</a></td></tr>
<tr class="separator:a5f12772a9d9be3dad93820d885a6bcc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Field Documentation</h2>
<a id="a9ac8dcc6750a564b336942ef5d458955" name="a9ac8dcc6750a564b336942ef5d458955"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ac8dcc6750a564b336942ef5d458955">&#9670;&#160;</a></span>allocate</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#aac6280c471e14b9c0d50b1c5577394d3">CCC_Allocator</a>* CCC_Array_tree_map::allocate</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The provided allocation function, if any. </p>

</div>
</div>
<a id="a2a7afb21dde4cff08c927cbe19b76f18" name="a2a7afb21dde4cff08c927cbe19b76f18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a7afb21dde4cff08c927cbe19b76f18">&#9670;&#160;</a></span>capacity</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t CCC_Array_tree_map::capacity</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The current capacity. </p>

</div>
</div>
<a id="af96de570b4860842765b9b0a2ce690dc" name="af96de570b4860842765b9b0a2ce690dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af96de570b4860842765b9b0a2ce690dc">&#9670;&#160;</a></span>compare</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="types_8h.html#a70073fb5defeba83308b92f2fff63fac">CCC_Key_comparator</a>* CCC_Array_tree_map::compare</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The provided key comparison function. </p>

</div>
</div>
<a id="a5f12772a9d9be3dad93820d885a6bcc8" name="a5f12772a9d9be3dad93820d885a6bcc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5f12772a9d9be3dad93820d885a6bcc8">&#9670;&#160;</a></span>context</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* CCC_Array_tree_map::context</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The provided context data, if any. </p>

</div>
</div>
<a id="a260771ed0124d74c1eba644669e07eea" name="a260771ed0124d74c1eba644669e07eea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a260771ed0124d74c1eba644669e07eea">&#9670;&#160;</a></span>count</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t CCC_Array_tree_map::count</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The current size. </p>

</div>
</div>
<a id="a025a6cc3eb3316bdb34e180b29d02957" name="a025a6cc3eb3316bdb34e180b29d02957"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a025a6cc3eb3316bdb34e180b29d02957">&#9670;&#160;</a></span>data</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* CCC_Array_tree_map::data</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The contiguous array of user data. </p>

</div>
</div>
<a id="a480c4dc805eef262657a79a4f40b72dd" name="a480c4dc805eef262657a79a4f40b72dd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a480c4dc805eef262657a79a4f40b72dd">&#9670;&#160;</a></span>free_list</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t CCC_Array_tree_map::free_list</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The start of the free singly linked list. </p>

</div>
</div>
<a id="ae68de9bf0bf0fed7ff1b92592f58e346" name="ae68de9bf0bf0fed7ff1b92592f58e346"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae68de9bf0bf0fed7ff1b92592f58e346">&#9670;&#160;</a></span>key_offset</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t CCC_Array_tree_map::key_offset</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Where user key can be found in type. </p>

</div>
</div>
<a id="a63ea33a04096cccedeee7f8ff3e7fcb9" name="a63ea33a04096cccedeee7f8ff3e7fcb9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63ea33a04096cccedeee7f8ff3e7fcb9">&#9670;&#160;</a></span>nodes</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structCCC__Array__tree__map__node.html">CCC_Array_tree_map_node</a>* CCC_Array_tree_map::nodes</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The contiguous array of WAVL tree meta data. </p>

</div>
</div>
<a id="a0a0ea7b9abddc4932b4366f456fcd086" name="a0a0ea7b9abddc4932b4366f456fcd086"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a0ea7b9abddc4932b4366f456fcd086">&#9670;&#160;</a></span>parity</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned* CCC_Array_tree_map::parity</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The parity bit array corresponding to each node. </p>

</div>
</div>
<a id="a3bed019d4d38e55783a0696eafd779b8" name="a3bed019d4d38e55783a0696eafd779b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bed019d4d38e55783a0696eafd779b8">&#9670;&#160;</a></span>root</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t CCC_Array_tree_map::root</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The root node of the WAVL tree. </p>

</div>
</div>
<a id="a23ab5d7c4b9a351dff64f8e8c5eca5bd" name="a23ab5d7c4b9a351dff64f8e8c5eca5bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23ab5d7c4b9a351dff64f8e8c5eca5bd">&#9670;&#160;</a></span>sizeof_type</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t CCC_Array_tree_map::sizeof_type</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The size of the type stored in the map. </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>ccc/private/<a class="el" href="private__array__tree__map_8h_source.html">private_array_tree_map.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="structCCC__Array__tree__map.html">CCC_Array_tree_map</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
